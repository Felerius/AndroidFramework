package kuchinke.com.airbar_tracking_app;


import android.bluetooth.BluetoothDevice;
import android.content.Intent;
import android.graphics.PointF;
import android.os.Bundle;
import android.support.design.widget.CoordinatorLayout;
import android.support.design.widget.Snackbar;
import android.support.v7.app.AppCompatActivity;
import android.util.Log;
import android.view.KeyEvent;
import android.view.MotionEvent;
import android.view.View;
import android.view.inputmethod.EditorInfo;
import android.widget.EditText;
import android.widget.TextView;

import java.util.ArrayList;
import java.util.List;
import java.util.Queue;
import java.util.UUID;



public class DeviceCommunicationActivity extends AppCompatActivity {
    private PrinterConnection.OnConnectionCallBack connectionCallBack;
    private PrinterConnection connection;


    private String TAG="Mainactivity";
    private TrackingSurface trackingSurface;

    private TextView messages;
    private EditText commandEdit;
    private CoordinatorLayout mainLayout;
    private Snackbar connectingSnackbar;
    private Queue<UUID> commandsToSend;
        // Register the BroadcastReceiver

        @Override
        protected void onCreate(final Bundle savedInstanceState) {
            super.onCreate(savedInstanceState);
            Log.d(TAG, "onCreate: ");
            setContentView(R.layout.activity_device_communication);
            Intent intent = getIntent();
            BluetoothDevice device= intent.getParcelableExtra("DEVICE");

            setupUiReferences();
            setupListeners();



            String input="<?xml version=\"1.0\" standalone=\"no\"?>\n" +
                    "<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 20010904//EN\"\n" +
                    " \"http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd\">\n" +
                    "<svg version=\"1.0\" xmlns=\"http://www.w3.org/2000/svg\"\n" +
                    " width=\"300.000000pt\" height=\"450.000000pt\" viewBox=\"0 0 300.000000 450.000000\"\n" +
                    " preserveAspectRatio=\"xMidYMid meet\">\n" +
                    "<metadata>\n" +
                    "Created by potrace 1.10, written by Peter Selinger 2001-2011\n" +
                    "</metadata>\n" +
                    "<g  transform=\"translate(0.000000,400.000000) scale(0.100000,-0.100000)\"\n" +
                    "fill=\"#000000\" stroke=\"none\">\n" +
                    "<path d=\"M1169 3937 c-38 -24 -64 -33 -81 -30 -14 3 -29 0 -33 -6 -5 -8 2 -10\n" +
                    "22 -5 19 5 25 3 18 -4 -5 -6 -24 -12 -40 -15 -17 -2 -48 -14 -70 -26 -44 -24\n" +
                    "-56 -20 -30 9 27 30 11 24 -53 -19 -86 -59 -138 -118 -162 -183 -14 -39 -34\n" +
                    "-68 -58 -88 -33 -28 -35 -30 -13 -28 13 2 26 -3 28 -10 4 -9 -3 -11 -24 -7\n" +
                    "-22 5 -24 4 -11 -4 10 -7 19 -33 24 -73 4 -35 8 -70 10 -78 1 -8 6 -46 9 -85\n" +
                    "4 -38 11 -76 15 -84 5 -9 -2 -23 -21 -39 -23 -19 -29 -32 -29 -63 0 -82 122\n" +
                    "-274 182 -286 22 -4 28 -11 28 -31 0 -34 12 -20 15 17 2 25 -2 30 -28 35 -46\n" +
                    "9 -78 43 -71 75 4 18 3 22 -4 12 -7 -10 -15 -6 -34 20 -51 69 -78 189 -43 189\n" +
                    "9 0 12 6 9 15 -10 25 8 17 37 -17 15 -18 31 -30 35 -25 4 4 -2 18 -14 30 -12\n" +
                    "13 -20 26 -17 29 3 3 -1 21 -9 39 -8 19 -19 81 -26 139 -7 58 -14 122 -17 142\n" +
                    "-4 30 2 52 31 107 20 39 36 75 36 82 0 16 69 99 82 99 5 0 24 10 41 22 17 13\n" +
                    "42 24 55 26 13 1 47 13 75 26 29 12 66 26 82 30 17 4 44 20 60 36 17 17 46 32\n" +
                    "65 35 31 4 32 4 10 -5 -22 -9 -20 -9 12 -6 24 3 41 0 49 -10 7 -8 29 -14 53\n" +
                    "-14 65 1 111 -7 147 -25 48 -25 137 -122 167 -184 29 -58 44 -70 67 -51 10 9\n" +
                    "15 9 15 1 0 -6 15 -11 33 -11 40 0 61 -20 76 -74 12 -46 7 -57 -14 -30 -14 18\n" +
                    "-15 16 -9 -17 7 -43 -5 -69 -51 -119 -18 -19 -33 -42 -33 -50 -1 -17 -5 -42\n" +
                    "-28 -150 -20 -93 -23 -104 -29 -99 -2 3 0 37 6 78 11 90 -6 153 -54 198 -50\n" +
                    "46 -55 47 -72 14 -15 -30 -45 -35 -69 -11 -17 17 -56 12 -56 -7 0 -14 2 -15 9\n" +
                    "-4 5 8 16 11 30 6 27 -8 27 -21 -1 -29 -33 -9 -36 -8 -58 14 -16 16 -20 17\n" +
                    "-20 5 0 -23 -20 -18 -42 11 -11 14 -23 23 -26 20 -2 -3 1 -13 9 -22 8 -9 14\n" +
                    "-24 14 -33 0 -28 67 -37 143 -19 118 29 115 29 135 2 22 -29 35 -114 31 -187\n" +
                    "-2 -28 1 -58 6 -66 6 -10 10 -11 10 -4 0 7 5 12 12 10 6 -1 17 18 25 43 7 25\n" +
                    "20 59 28 77 8 17 15 44 15 60 1 53 19 106 43 127 43 36 61 84 62 164 0 68 -2\n" +
                    "76 -27 97 -19 17 -35 21 -61 19 -20 -3 -38 0 -42 5 -3 6 -12 8 -19 5 -9 -3\n" +
                    "-25 15 -45 50 -39 68 -113 151 -162 182 -29 18 -56 24 -119 28 -44 2 -86 9\n" +
                    "-93 15 -7 5 -31 13 -52 16 -34 5 -49 1 -96 -28z m451 -562 c0 -8 -4 -15 -10\n" +
                    "-15 -5 0 -10 7 -10 15 0 8 5 15 10 15 6 0 10 -7 10 -15z\"/>\n" +
                    "<path d=\"M1213 3913 c-13 -2 -23 -8 -23 -13 0 -9 62 -2 95 11 15 6 12 8 -15 7\n" +
                    "-19 0 -45 -3 -57 -5z\"/>\n" +
                    "<path d=\"M1322 3857 c-9 -10 -4 -12 23 -9 19 2 32 8 29 13 -8 13 -40 11 -52\n" +
                    "-4z\"/>\n" +
                    "<path d=\"M1345 3830 c-3 -5 1 -10 9 -10 9 0 16 5 16 10 0 6 -4 10 -9 10 -6 0\n" +
                    "-13 -4 -16 -10z\"/>\n" +
                    "<path d=\"M1350 3710 c-8 -5 -11 -12 -7 -16 4 -4 13 -2 19 4 15 15 7 24 -12 12z\"/>\n" +
                    "<path d=\"M1470 3545 c14 -16 46 -20 54 -6 10 15 -7 21 -22 8 -12 -9 -16 -9\n" +
                    "-19 1 -3 6 -9 12 -15 12 -6 0 -6 -6 2 -15z\"/>\n" +
                    "<path d=\"M1410 3530 c0 -5 5 -10 11 -10 5 0 7 5 4 10 -3 6 -8 10 -11 10 -2 0\n" +
                    "-4 -4 -4 -10z\"/>\n" +
                    "<path d=\"M1480 3481 c0 -11 5 -23 10 -26 6 -3 10 3 10 14 0 11 -4 23 -10 26\n" +
                    "-5 3 -10 -3 -10 -14z\"/>\n" +
                    "<path d=\"M1134 3435 c11 -8 22 -12 25 -9 6 6 -19 24 -34 24 -5 -1 -1 -7 9 -15z\"/>\n" +
                    "<path d=\"M1665 3440 c3 -5 11 -10 16 -10 6 0 7 5 4 10 -3 6 -11 10 -16 10 -6\n" +
                    "0 -7 -4 -4 -10z\"/>\n" +
                    "<path d=\"M1535 3410 c3 -5 13 -10 21 -10 8 0 14 5 14 10 0 6 -9 10 -21 10 -11\n" +
                    "0 -17 -4 -14 -10z\"/>\n" +
                    "<path d=\"M1660 3410 c0 -5 5 -10 11 -10 5 0 7 5 4 10 -3 6 -8 10 -11 10 -2 0\n" +
                    "-4 -4 -4 -10z\"/>\n" +
                    "<path d=\"M1538 3383 c7 -3 16 -2 19 1 4 3 -2 6 -13 5 -11 0 -14 -3 -6 -6z\"/>\n" +
                    "<path d=\"M906 3206 c-10 -15 -12 -27 -6 -31 6 -3 15 6 20 21 14 36 7 41 -14\n" +
                    "10z\"/>\n" +
                    "<path d=\"M1562 3203 c-18 -3 -36 -11 -39 -19 -8 -21 1 -26 28 -15 13 5 36 12\n" +
                    "52 15 15 4 27 11 27 16 0 10 -7 10 -68 3z\"/>\n" +
                    "<path d=\"M1153 3192 c-29 -2 -53 -7 -53 -13 0 -10 19 -13 67 -10 17 1 48 -2\n" +
                    "68 -8 27 -7 35 -7 32 2 -6 19 -59 32 -114 29z\"/>\n" +
                    "<path d=\"M1585 3159 c-16 -6 -14 -8 13 -8 33 -1 41 4 20 12 -7 2 -22 1 -33 -4z\"/>\n" +
                    "<path d=\"M1486 3131 c-29 -17 -39 -47 -25 -73 14 -26 76 -24 106 4 13 12 23\n" +
                    "17 23 12 0 -16 64 -10 68 6 5 30 -22 48 -85 58 -49 7 -67 6 -87 -7z m62 -22\n" +
                    "c-11 -6 -15 -16 -11 -27 6 -15 5 -15 -10 -3 -22 17 -22 28 1 34 30 8 38 7 20\n" +
                    "-4z m77 -11 c7 -7 2 -8 -15 -3 -14 4 -29 12 -35 17 -7 7 -2 8 15 3 14 -4 30\n" +
                    "-12 35 -17z m-140 -8 c3 -5 1 -10 -4 -10 -6 0 -11 5 -11 10 0 6 2 10 4 10 3 0\n" +
                    "8 -4 11 -10z\"/>\n" +
                    "<path d=\"M1120 3130 c0 -13 40 -13 60 0 11 7 5 10 -22 10 -21 0 -38 -4 -38\n" +
                    "-10z\"/>\n" +
                    "<path d=\"M1260 3120 c-13 -9 -13 -11 0 -20 8 -5 30 -10 48 -10 31 0 32 -1 32\n" +
                    "-45 0 -25 4 -45 9 -45 5 0 15 20 23 45 14 43 14 45 -3 45 -11 0 -28 9 -39 20\n" +
                    "-22 22 -47 25 -70 10z\"/>\n" +
                    "<path d=\"M1155 3111 c-34 -9 -79 -31 -73 -37 2 -2 21 1 41 7 36 10 57 6 57\n" +
                    "-10 0 -5 -16 -8 -35 -7 -19 0 -34 -3 -35 -9 0 -5 6 -10 13 -10 6 0 22 -6 34\n" +
                    "-13 24 -14 53 -7 53 13 0 8 5 17 12 21 8 5 9 2 5 -9 -5 -12 1 -19 18 -23 13\n" +
                    "-3 26 -13 28 -22 2 -10 5 0 8 20 3 20 1 34 -3 32 -4 -3 -17 5 -28 16 -12 12\n" +
                    "-29 19 -43 17 -12 -2 -16 -2 -9 0 6 3 12 9 12 14 0 10 -12 10 -55 0z\"/>\n" +
                    "<path d=\"M711 3088 c0 -7 4 -22 9 -33 8 -18 9 -17 9 7 1 15 -3 30 -9 33 -5 3\n" +
                    "-10 0 -9 -7z\"/>\n" +
                    "<path d=\"M787 3053 c-14 -14 -6 -24 14 -18 18 6 20 4 14 -14 -7 -22 10 -30 18\n" +
                    "-8 10 28 -26 60 -46 40z\"/>\n" +
                    "<path d=\"M860 3037 c0 -9 12 -29 26 -44 l26 -28 -23 40 c-29 51 -29 51 -29 32z\"/>\n" +
                    "<path d=\"M753 2995 c1 -21 10 -34 32 -45 16 -8 35 -21 43 -27 18 -17 42 -16\n" +
                    "42 0 0 15 -41 57 -55 57 -4 0 4 -11 18 -24 14 -13 23 -26 20 -29 -8 -9 -84 55\n" +
                    "-94 78 -7 17 -8 15 -6 -10z\"/>\n" +
                    "<path d=\"M1360 2963 c0 -14 3 -23 7 -19 10 10 11 46 1 46 -4 0 -8 -12 -8 -27z\"/>\n" +
                    "<path d=\"M1252 2880 c-24 -38 -28 -60 -12 -60 12 0 42 69 37 84 -2 6 -14 -5\n" +
                    "-25 -24z\"/>\n" +
                    "<path d=\"M1400 2864 c0 -15 -4 -16 -67 -19 -31 -1 -43 3 -46 15 -4 12 -5 12\n" +
                    "-6 -2 0 -9 5 -20 11 -25 14 -8 20 -9 86 -11 50 -2 55 -27 6 -27 -18 0 -30 -6\n" +
                    "-32 -16 -2 -12 7 -16 37 -17 32 -2 43 3 52 20 9 17 9 23 0 26 -8 3 -9 8 -2 16\n" +
                    "6 8 2 18 -15 33 -17 16 -24 18 -24 7z\"/>\n" +
                    "<path d=\"M1465 2810 c-3 -5 -2 -10 4 -10 5 0 13 5 16 10 3 6 2 10 -4 10 -5 0\n" +
                    "-13 -4 -16 -10z\"/>\n" +
                    "<path d=\"M1340 2739 c-14 -4 -44 -7 -66 -8 -41 -1 -71 -21 -60 -39 7 -12 55\n" +
                    "-22 61 -12 2 4 65 5 140 4 114 -2 137 0 142 12 9 23 -11 36 -59 40 -109 9\n" +
                    "-135 9 -158 3z m145 -28 c18 -3 -20 -8 -90 -11 -129 -5 -191 1 -115 11 59 8\n" +
                    "167 8 205 0z\"/>\n" +
                    "<path d=\"M890 2733 c0 -6 7 -42 15 -80 9 -37 18 -78 20 -91 4 -17 -1 -25 -21\n" +
                    "-34 -26 -12 -78 -81 -121 -162 -13 -22 -32 -49 -43 -58 -21 -17 -20 -18 41\n" +
                    "-110 71 -105 91 -130 197 -243 154 -163 449 -559 563 -755 18 -30 77 -122 132\n" +
                    "-203 l100 -149 -7 -55 c-5 -40 0 -84 20 -171 14 -64 28 -133 30 -152 13 -107\n" +
                    "52 -274 53 -228 1 9 -3 28 -9 43 -5 14 -15 67 -21 118 -6 50 -21 143 -35 205\n" +
                    "-28 131 -32 224 -10 216 15 -6 22 8 30 66 3 19 12 64 20 100 19 83 22 105 43\n" +
                    "275 30 255 -9 649 -82 820 -48 111 -69 151 -115 214 -27 38 -50 73 -50 79 0\n" +
                    "16 -69 72 -89 72 -33 0 -41 -74 -15 -136 13 -30 15 -58 11 -124 -5 -71 -12\n" +
                    "-97 -43 -157 -20 -40 -39 -73 -43 -73 -13 1 -49 36 -62 60 -7 14 -12 39 -11\n" +
                    "56 3 45 -24 71 -80 78 -29 3 -48 2 -48 -4 0 -6 7 -10 16 -10 8 0 12 -5 9 -11\n" +
                    "-5 -6 -21 4 -41 27 -19 20 -37 34 -41 30 -4 -3 12 -26 35 -49 56 -57 54 -73\n" +
                    "-1 -19 -43 42 -44 42 -61 23 -12 -13 -26 -18 -43 -15 -21 4 -23 3 -12 -9 8 -7\n" +
                    "22 -16 32 -20 9 -3 17 -11 17 -16 0 -18 33 -21 52 -4 15 14 21 14 31 3 10 -10\n" +
                    "9 -12 -5 -7 -23 8 -24 -9 -2 -17 9 -4 14 -9 11 -12 -3 -3 -12 -2 -19 2 -7 5\n" +
                    "-28 10 -47 11 -35 2 -101 54 -101 80 0 7 -6 13 -14 13 -8 0 -16 7 -20 15 -3 8\n" +
                    "-11 15 -18 15 -7 0 8 -20 32 -45 24 -25 39 -45 33 -45 -6 0 -16 7 -23 15 -7 8\n" +
                    "-20 15 -30 15 -10 0 -23 7 -30 15 -7 8 -18 15 -24 15 -17 1 -68 49 -62 59 4 7\n" +
                    "-46 144 -58 158 -1 1 -6 -9 -12 -22 -7 -14 -9 -24 -5 -23 3 0 12 0 20 -1 15\n" +
                    "-1 7 -15 -10 -17 -5 -1 -12 -2 -15 -3 -3 0 2 -8 10 -17 9 -8 16 -20 16 -25 0\n" +
                    "-5 -13 4 -30 21 -16 17 -30 35 -30 40 0 6 -6 9 -12 8 -23 -5 -8 35 35 94 23\n" +
                    "31 46 57 50 57 5 1 5 -4 2 -9 -8 -14 4 -72 14 -66 4 3 15 -10 24 -29 9 -19 22\n" +
                    "-35 28 -35 6 0 8 -9 4 -22 -5 -18 -4 -20 4 -8 9 13 11 12 11 -4 0 -11 3 -16 7\n" +
                    "-13 4 4 13 -7 20 -24 11 -26 15 -29 28 -19 12 10 15 10 15 -2 0 -8 9 -23 19\n" +
                    "-32 19 -17 19 -17 16 10 -1 16 -8 30 -15 32 -20 7 -87 78 -114 121 -14 22 -30\n" +
                    "42 -36 46 -12 7 -14 75 -1 75 4 0 7 -10 5 -22 -3 -16 12 -43 47 -86 28 -35 53\n" +
                    "-61 56 -58 3 3 -16 31 -42 63 -45 56 -47 60 -41 107 3 30 -1 75 -10 115 -16\n" +
                    "65 -43 137 -44 114z m675 -313 c3 -5 1 -10 -4 -10 -6 0 -11 5 -11 10 0 6 2 10\n" +
                    "4 10 3 0 8 -4 11 -10z m31 -36 c18 -15 18 -15 -8 -9 -16 3 -28 1 -28 -4 0 -5\n" +
                    "12 -11 27 -13 14 -2 29 -10 31 -18 5 -13 3 -13 -11 -1 -15 12 -17 11 -17 -3 0\n" +
                    "-10 9 -16 24 -16 14 0 28 -4 31 -10 3 -5 1 -10 -4 -10 -6 0 -11 -4 -11 -10 0\n" +
                    "-5 7 -10 15 -10 8 0 15 -9 15 -20 0 -11 6 -20 13 -20 15 0 37 -46 37 -76 0\n" +
                    "-13 5 -26 11 -30 8 -4 9 0 4 15 -3 11 -2 21 3 21 6 0 13 -12 16 -27 4 -16 10\n" +
                    "-37 13 -48 5 -19 4 -19 -19 3 -25 23 -48 29 -48 12 0 -5 5 -10 11 -10 20 0 37\n" +
                    "-26 28 -42 -6 -10 -4 -15 7 -15 9 0 13 6 9 14 -3 10 2 13 18 11 17 -2 24 -12\n" +
                    "29 -43 9 -50 34 -168 54 -260 19 -81 23 -460 6 -490 -8 -16 -11 -14 -17 13 -3\n" +
                    "18 -11 34 -16 37 -14 9 -11 -19 4 -33 21 -22 15 -184 -13 -303 -24 -105 -24\n" +
                    "-105 -40 -78 -8 15 -49 78 -91 141 -42 62 -95 145 -119 183 -80 129 -107 169\n" +
                    "-217 316 -59 81 -126 172 -148 202 -22 30 -106 129 -186 219 -172 192 -255\n" +
                    "310 -234 328 12 10 20 5 42 -21 44 -54 101 -109 113 -109 5 0 32 -15 58 -33\n" +
                    "79 -55 209 -116 221 -104 8 8 14 8 23 -1 7 -7 32 -12 56 -12 l44 0 -6 34 c-7\n" +
                    "34 4 53 24 41 6 -4 6 -15 0 -30 -6 -16 -6 -25 0 -25 6 0 10 -6 10 -14 0 -8 23\n" +
                    "-41 50 -74 28 -33 50 -66 50 -73 -1 -21 -38 -61 -50 -54 -26 16 30 -62 57 -80\n" +
                    "35 -23 52 -63 60 -140 3 -30 14 -79 24 -107 19 -57 24 -47 9 17 -5 22 -15 69\n" +
                    "-20 105 -6 36 -13 76 -16 90 -4 19 -3 21 5 10 5 -8 13 -37 17 -65 8 -64 11\n" +
                    "-80 25 -138 6 -26 9 -61 7 -77 -2 -16 -1 -27 2 -25 4 3 13 -28 19 -68 6 -39\n" +
                    "16 -79 21 -87 15 -25 23 -3 10 32 -6 18 -16 58 -20 88 -5 30 -12 68 -16 84 -8\n" +
                    "32 9 49 41 40 19 -6 19 -5 3 12 -13 14 -20 15 -31 5 -12 -9 -16 -6 -22 16 -4\n" +
                    "16 -9 39 -10 53 -2 25 -13 81 -35 170 -7 25 -11 59 -11 75 2 32 55 213 76 256\n" +
                    "10 21 10 33 -1 65 -8 21 -14 53 -14 69 0 17 -9 55 -20 85 -31 87 -22 113 26\n" +
                    "74z m-693 -126 c-2 -5 0 -8 6 -8 6 0 8 -7 4 -15 -3 -9 -8 -14 -10 -11 -3 2 -4\n" +
                    "6 -2 8 1 2 -3 13 -10 26 -6 12 -9 28 -5 34 8 13 25 -21 17 -34z m666 -187 c-7\n" +
                    "-25 -23 -70 -36 -99 -13 -29 -23 -66 -23 -82 0 -17 -4 -30 -9 -30 -17 0 -4 76\n" +
                    "22 127 39 76 33 79 -9 5 -20 -35 -38 -61 -40 -59 -3 2 11 31 30 63 19 33 40\n" +
                    "77 46 99 22 70 23 72 28 46 2 -13 -2 -45 -9 -70z m-209 59 c0 -5 -2 -10 -4\n" +
                    "-10 -3 0 -8 5 -11 10 -3 6 -1 10 4 10 6 0 11 -4 11 -10z m-30 -10 c0 -5 -6\n" +
                    "-10 -14 -10 -17 0 -28 -37 -14 -46 6 -4 6 -10 -1 -17 -22 -22 -31 7 -14 46 16\n" +
                    "34 43 51 43 27z m-117 -7 c11 -10 -13 -32 -28 -27 -8 3 -11 12 -8 20 5 15 25\n" +
                    "19 36 7z m263 -292 c-15 -16 -15 -19 -1 -31 9 -7 19 -10 22 -6 4 4 1 11 -6 15\n" +
                    "-8 5 -9 11 -3 15 11 7 25 -21 16 -35 -3 -5 0 -9 6 -9 6 0 8 -5 5 -10 -8 -13\n" +
                    "-65 26 -65 44 0 14 20 36 34 36 5 0 2 -8 -8 -19z\"/>\n" +
                    "<path d=\"M860 2191 c5 -11 15 -23 21 -27 6 -3 3 5 -6 20 -20 30 -30 35 -15 7z\"/>\n" +
                    "<path d=\"M1015 2090 c16 -16 49 -37 74 -47 67 -25 149 -78 207 -135 49 -48 52\n" +
                    "-49 52 -24 0 14 -5 26 -10 26 -5 0 -6 -6 -2 -12 4 -7 -12 5 -35 27 -22 21 -41\n" +
                    "41 -41 44 0 3 16 -10 35 -29 19 -19 35 -29 35 -23 0 7 -19 27 -42 46 -52 42\n" +
                    "-74 55 -64 39 4 -7 3 -12 -3 -12 -5 0 -12 4 -15 9 -4 5 -43 27 -89 49 -45 21\n" +
                    "-88 47 -96 56 -7 9 -18 16 -24 16 -6 0 2 -13 18 -30z m240 -118 c-3 -3 -11 0\n" +
                    "-18 7 -9 10 -8 11 6 5 10 -3 15 -9 12 -12z\"/>\n" +
                    "<path d=\"M1632 2064 c-12 -8 -22 -20 -22 -26 0 -6 8 -4 18 5 10 10 24 17 30\n" +
                    "17 7 0 12 5 12 10 0 14 -12 12 -38 -6z\"/>\n" +
                    "<path d=\"M1765 2040 c-3 -5 -1 -10 4 -10 6 0 11 5 11 10 0 6 -2 10 -4 10 -3 0\n" +
                    "-8 -4 -11 -10z\"/>\n" +
                    "<path d=\"M1690 2033 c0 -5 5 -14 11 -20 8 -8 5 -13 -11 -18 -26 -8 -90 -63\n" +
                    "-90 -77 0 -6 16 4 35 21 20 17 45 33 58 36 21 6 54 55 37 55 -5 0 -15 3 -24 6\n" +
                    "-9 3 -16 2 -16 -3z\"/>\n" +
                    "<path d=\"M1580 1970 c-6 -11 -8 -20 -6 -20 3 0 10 9 16 20 6 11 8 20 6 20 -3\n" +
                    "0 -10 -9 -16 -20z\"/>\n" +
                    "<path d=\"M1393 1914 c-3 -8 -1 -20 5 -26 11 -11 32 -3 32 13 0 6 -4 7 -10 4\n" +
                    "-6 -3 -7 1 -4 9 3 9 1 16 -5 16 -7 0 -14 -7 -18 -16z\"/>\n" +
                    "<path d=\"M1542 1820 c0 -14 2 -19 5 -12 2 6 2 18 0 25 -3 6 -5 1 -5 -13z\"/>\n" +
                    "<path d=\"M1570 1723 c0 -6 -3 -18 -6 -27 -4 -11 -1 -16 10 -16 9 0 16 6 16 13\n" +
                    "0 16 -20 46 -20 30z\"/>\n" +
                    "<path d=\"M1651 1575 c0 -6 7 -26 15 -45 l14 -35 -6 35 c-5 31 -25 69 -23 45z\"/>\n" +
                    "<path d=\"M1690 1474 c0 -6 14 -23 30 -39 17 -16 30 -25 30 -19 -1 12 -60 70\n" +
                    "-60 58z\"/>\n" +
                    "<path d=\"M1600 1460 c0 -13 12 -19 26 -13 21 8 17 19 -6 19 -11 0 -20 -3 -20\n" +
                    "-6z\"/>\n" +
                    "<path d=\"M1750 1456 c0 -6 49 -105 57 -115 2 -2 5 -2 8 1 8 8 -30 91 -49 107\n" +
                    "-9 7 -16 11 -16 7z\"/>\n" +
                    "<path d=\"M1716 1340 c8 -31 24 -50 24 -29 0 8 -7 24 -16 35 -14 18 -15 18 -8\n" +
                    "-6z\"/>\n" +
                    "<path d=\"M1770 1320 c11 -21 20 -46 20 -55 0 -8 4 -15 9 -15 6 0 6 11 1 28\n" +
                    "-12 43 -32 82 -42 82 -5 0 1 -18 12 -40z\"/>\n" +
                    "<path d=\"M1743 1265 c6 -36 -15 -70 -38 -62 -8 4 -15 2 -15 -4 0 -22 34 -22\n" +
                    "52 0 20 26 23 58 7 81 -8 12 -10 8 -6 -15z\"/>\n" +
                    "<path d=\"M1648 1193 c7 -3 16 -2 19 1 4 3 -2 6 -13 5 -11 0 -14 -3 -6 -6z\"/>\n" +
                    "<path d=\"M1800 1113 c0 -16 5 -35 10 -43 7 -11 10 -4 10 28 0 23 -4 42 -10 42\n" +
                    "-5 0 -10 -12 -10 -27z\"/>\n" +
                    "<path d=\"M1364 2655 c11 -8 29 -15 40 -15 19 1 19 2 -4 15 -35 20 -62 19 -36\n" +
                    "0z\"/>\n" +
                    "<path d=\"M1354 2615 c22 -17 64 -19 86 -5 8 5 13 10 10 10 -3 1 -30 3 -60 5\n" +
                    "-50 4 -53 3 -36 -10z\"/>\n" +
                    "<path d=\"M1378 2483 c-16 -2 -28 -9 -28 -14 0 -13 31 -10 60 6 25 14 19 16\n" +
                    "-32 8z\"/>\n" +
                    "<path d=\"M1438 2452 c-27 -9 -48 -20 -48 -25 0 -13 44 -1 83 23 37 23 31 23\n" +
                    "-35 2z\"/>\n" +
                    "<path d=\"M1720 2280 c0 -13 46 -32 243 -97 l168 -56 68 -66 c57 -55 72 -77 90\n" +
                    "-131 46 -134 71 -245 71 -317 0 -42 4 -73 10 -73 17 0 11 150 -9 225 -54 199\n" +
                    "-88 261 -178 334 -46 36 -84 53 -241 107 -103 35 -195 68 -204 74 -12 6 -18 7\n" +
                    "-18 0z\"/>\n" +
                    "<path d=\"M1100 2216 c0 -17 28 -41 49 -41 10 0 15 -7 13 -19 -3 -15 -1 -16 11\n" +
                    "-5 22 21 3 52 -26 43 -12 -3 -19 -3 -15 1 9 9 -9 35 -23 35 -5 0 -9 -6 -9 -14z\"/>\n" +
                    "<path d=\"M1106 2155 c4 -8 11 -15 16 -15 6 0 5 6 -2 15 -7 8 -14 15 -16 15 -2\n" +
                    "0 -1 -7 2 -15z\"/>\n" +
                    "<path d=\"M670 1624 c0 -3 11 -24 24 -47 30 -53 63 -159 77 -251 14 -92 28\n" +
                    "-117 29 -51 0 114 -36 238 -93 322 -20 30 -37 42 -37 27z\"/>\n" +
                    "<path d=\"M753 1544 c37 -74 57 -149 63 -244 15 -249 31 -386 50 -422 19 -37\n" +
                    "26 -35 20 5 -3 17 -8 59 -11 92 -3 33 -10 85 -15 115 -5 30 -12 105 -15 165\n" +
                    "-7 129 -25 209 -63 278 -36 67 -62 76 -29 11z\"/>\n" +
                    "<path d=\"M2390 1473 c0 -4 9 -42 20 -83 11 -41 22 -84 25 -95 3 -11 7 -60 10\n" +
                    "-109 3 -49 7 -92 10 -94 14 -14 6 167 -9 218 -8 25 -20 71 -27 103 -7 32 -16\n" +
                    "60 -21 63 -4 3 -8 2 -8 -3z\"/>\n" +
                    "<path d=\"M526 1357 c42 -80 96 -142 173 -198 33 -24 65 -54 70 -67 6 -13 11\n" +
                    "-69 11 -125 0 -75 6 -119 21 -167 15 -49 21 -101 25 -210 l4 -145 41 -70 c22\n" +
                    "-38 47 -92 55 -120 8 -27 26 -84 41 -125 14 -41 28 -87 30 -102 3 -16 12 -28\n" +
                    "20 -28 11 0 14 7 10 27 -11 63 -97 293 -132 353 l-37 65 -3 135 c-1 79 -10\n" +
                    "170 -20 220 -9 46 -15 102 -12 125 3 22 0 94 -7 161 -11 103 -16 125 -36 145\n" +
                    "-12 13 -30 40 -39 59 -30 64 -52 102 -57 98 -4 -5 53 -141 85 -202 39 -75 7\n" +
                    "-67 -99 24 -30 26 -80 84 -110 129 -30 44 -58 81 -61 81 -4 0 8 -29 27 -63z\"/>\n" +
                    "<path d=\"M2465 1053 c62 -154 89 -363 59 -450 -6 -14 -4 -16 6 -6 20 19 24\n" +
                    "148 7 243 -18 106 -56 230 -69 230 -6 0 -7 -8 -3 -17z\"/>\n" +
                    "<path d=\"M153 817 c9 -24 128 -521 152 -637 8 -41 20 -99 27 -127 6 -29 15\n" +
                    "-53 20 -53 6 0 7 8 3 18 -3 9 -18 71 -31 137 -14 66 -47 210 -74 320 -27 110\n" +
                    "-57 235 -67 277 -10 43 -22 78 -27 78 -4 0 -6 -6 -3 -13z\"/>\n" +
                    "<path d=\"M1809 798 c-9 -29 -2 -148 14 -228 9 -47 19 -102 22 -124 4 -21 8\n" +
                    "-36 11 -34 4 4 -10 134 -21 188 -11 60 -17 86 -21 101 -3 11 2 15 17 15 30 -1\n" +
                    "46 26 33 61 -10 30 -48 44 -55 21z m28 -50 c-3 -7 -5 -2 -5 12 0 14 2 19 5 13\n" +
                    "2 -7 2 -19 0 -25z\"/>\n" +
                    "<path d=\"M1791 744 c0 -11 3 -14 6 -6 3 7 2 16 -1 19 -3 4 -6 -2 -5 -13z\"/>\n" +
                    "<path d=\"M560 720 c0 -5 5 -10 10 -10 6 0 10 5 10 10 0 6 -4 10 -10 10 -5 0\n" +
                    "-10 -4 -10 -10z\"/>\n" +
                    "<path d=\"M1870 410 c-12 -22 -4 -64 15 -80 34 -28 77 47 47 83 -20 23 -49 22\n" +
                    "-62 -3z m36 -47 c-11 -11 -19 6 -11 24 8 17 8 17 12 0 3 -10 2 -21 -1 -24z\"/>\n" +
                    "<path d=\"M1871 290 c6 -24 8 -55 5 -69 -6 -29 17 -207 28 -219 4 -4 6 20 3 53\n" +
                    "-2 33 -2 48 0 33 2 -16 8 -28 12 -28 9 0 7 16 -20 155 -11 55 -24 104 -29 109\n" +
                    "-5 4 -4 -11 1 -34z m27 -140 c0 -22 -1 -22 -8 5 -4 17 -8 39 -8 50 0 16 2 15\n" +
                    "8 -5 4 -14 8 -36 8 -50z\"/>\n" +
                    "<path d=\"M1921 34 c0 -11 3 -14 6 -6 3 7 2 16 -1 19 -3 4 -6 -2 -5 -13z\"/>\n" +
                    "<path d=\"M1946 43 c-3 -4 -6 -14 -6 -23 0 -12 10 -16 35 -17 19 -1 35 2 35 7\n" +
                    "0 17 -53 44 -64 33z\"/>\n" +
                    "</g>\n" +
                    "</svg>\n";
            //input=input.replaceAll("\n","");




            trackingSurface= (TrackingSurface) findViewById(R.id.trackingSurface);
            trackingSurface.setOnTouchListener(new View.OnTouchListener() {
                @Override
                public boolean onTouch(View view, MotionEvent motionEvent) {
                    float x=motionEvent.getX();
                    float y=motionEvent.getY();
                    trackingSurface.drawTrackingCircle((int)x,(int)y,-1,-1);

                    return false;
                }
            });

            //connection= new BluetoothConnection(this, device);
            connection=new BluetoothConnection(this,device);
            connectingSnackbar= Snackbar.make(mainLayout,"Connecting", Snackbar.LENGTH_INDEFINITE);
            connectingSnackbar.show();
            connection.setOnConnectionCallBack(connectionCallBack);
            connection.connect();




           

            Log.d(TAG, "onCreate: create finished");
        }



        @Override
        protected void onDestroy() {
            super.onDestroy();
            if(connection!=null)connection.tearDown();

        }











    void setupUiReferences(){
        mainLayout=(CoordinatorLayout) findViewById(R.id.coordinatorlayout);
        messages=(TextView)findViewById(R.id.textView);
        commandEdit= (EditText)findViewById(R.id.commandEdit);
        commandEdit.setImeOptions(EditorInfo.IME_ACTION_DONE);
    }
    void setupListeners(){
        commandEdit.setOnEditorActionListener(new TextView.OnEditorActionListener() {
            @Override
            public boolean onEditorAction(TextView v, int actionId, KeyEvent event) {
                if (actionId==EditorInfo.IME_ACTION_DONE){
                    if(commandEdit.getText().length()>0){
                        String message=v.getText().toString();
                        connection.write(message);
                    }



                }
                return true;
            }
        });

        connectionCallBack= new PrinterConnection.OnConnectionCallBack() {


            @Override
            public void connectionEstablished() {
                if(connectingSnackbar.isShown())connectingSnackbar.dismiss();
                Log.d(TAG, "connectionEstablished: starting to parse ");
                Snackbar snackbar= Snackbar.make(mainLayout,"Connection established", Snackbar.LENGTH_SHORT);
                snackbar.show();



            }

            @Override
            public void connectionLost() {
                if(connectingSnackbar.isShown())connectingSnackbar.dismiss();
                Snackbar snackbar= Snackbar.make(mainLayout,"Connection Lost", Snackbar.LENGTH_INDEFINITE);
                snackbar.setAction("Close", new View.OnClickListener() {
                    @Override
                    public void onClick(View v) {
                        finish();
                    }
                });
                snackbar.show();
            }

            @Override
            public void connectionRefused() {
                if(connectingSnackbar.isShown())connectingSnackbar.dismiss();
                Snackbar snackbar= Snackbar.make(mainLayout,"Connection Refused", Snackbar.LENGTH_INDEFINITE);
                snackbar.setAction("Close", new View.OnClickListener() {
                    @Override
                    public void onClick(View v) {
                        finish();
                    }
                });
                snackbar.show();
            }

            @Override
            public void newCharsAvailable(final byte[] c, final int byteCount) {
                final String message=new String(c,0,byteCount);
                Log.d(TAG, "newCharsAvailable: "+message);
                String [] xy=message.split(",");
                int x1=Integer.valueOf(xy[0]);
                int y1=Integer.valueOf(xy[1]);
                int x2=Integer.valueOf(xy[2]);
                int y2=Integer.valueOf(xy[3]);
                Log.d(TAG, "newCharsAvailable: x: "+x1);
                Log.d(TAG, "newCharsAvailable: y: "+y1);
                trackingSurface.drawTrackingCircle(y1,x1,y2,x2);
                runOnUiThread(new Runnable() {
                    @Override
                    public void run() {
                        messages.append(message+"\n");
                    }
                });





            }
        };

    }









    private List<String> getParts(String string, int partitionSize, char followingIndicator) {
        List<String> parts = new ArrayList<String>();
        int len = string.length();
        for (int i=0; i<len; i+=partitionSize)
        {
            String p=string.substring(i, Math.min(len, i + partitionSize));
            if(i<len-partitionSize)p+=followingIndicator;
            parts.add(p);

        }

        for(String p: parts) Log.d(TAG, "getParts: "+p);
        return parts;
    }

    }

